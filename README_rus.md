# Watcher (Video Surveillance Toolkit)

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Watcher ‚Äî —ç—Ç–æ –ª–æ–∫–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è –¥–ª—è macOS, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É–∂–± –∏–ª–∏ –ª–∏—á–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –∫–æ—Ç–æ—Ä–∞—è:
- –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤–∏–¥–µ–æ —Å –≤–Ω–µ—à–Ω–µ–π USB-–∫–∞–º–µ—Ä—ã,
- –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏ —Å–∂–∏–º–∞–µ—Ç –∏—Ö –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª,
- –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ Telegram-–∫–∞–Ω–∞–ª,
- —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ñ–ª–∞–π–Ω –∏ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ, –∫–∞–∫ —Ñ–æ–Ω–æ–≤—ã–π –∞–≥–µ–Ω—Ç, –≤–∏–¥–∏–º—ã–π –≤ –º–µ–Ω—é–±–∞—Ä–µ macOS.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —Ä–æ–ª–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–¥–µ–ª—ë–Ω –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–¥–Ω—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É:

### 1. capture_video.py
**‚è± –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç 1-–º–∏–Ω—É—Ç–Ω—ã–µ –≤–∏–¥–µ–æ—Ñ–∞–π–ª—ã —Å –≤–Ω–µ—à–Ω–µ–π –∫–∞–º–µ—Ä—ã (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É).

**üì¶ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ffmpeg —á–µ—Ä–µ–∑ subprocess
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –≤–Ω–µ—à–Ω–µ–π –∫–∞–º–µ—Ä–æ–π (AVFoundation, –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º–æ–π)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç .mp4 –≤ videos/
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–æ—Ç–∞—Ü–∏–µ–π

### 2. merge_and_send.py
**üéû –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ .mp4 –≤–∏–¥–µ–æ –≤–æ–µ–¥–∏–Ω–æ
- –°–∂–∏–º–∞–µ—Ç –∏—Ö –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram-–∫–∞–Ω–∞–ª
- –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–∏ —É—Å–ø–µ—Ö–µ

**üì¶ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ffmpeg –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –∏ —Å–∂–∞—Ç–∏—è
- –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç)
- –û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ Telegram —á–µ—Ä–µ–∑ notify_telegram()

### 3. tray_app.py
**üñ• –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∫–æ–Ω–∫—É –≤ –º–µ–Ω—é–±–∞—Ä–µ macOS
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–æ–Ω–æ–≤—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏ (start, stop, status)
- –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å launchctl
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ª–æ–≥–∏ –∏ –Ω–∞–±–ª—é–¥–∞—Ç—å –∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º –∞–≥–µ–Ω—Ç–æ–≤

**üì¶ –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞:** rumps (Python-to-macOS MenuBar framework)

### 4. logger.py
**ü™µ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –°–æ–∑–¥–∞—ë—Ç –ª–æ–≥–≥–µ—Ä—ã, –ø–∏—à—É—â–∏–µ –≤ —Ñ–∞–π–ª –∏ –∫–æ–Ω—Å–æ–ª—å
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–æ—Ç–∞—Ü–∏—é –ª–æ–≥–æ–≤
- –†–µ–∞–ª–∏–∑—É–µ—Ç notify_telegram(message) ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –æ—à–∏–±–æ–∫

### 5. config.py + .env
**‚öôÔ∏è –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –•—Ä–∞–Ω–∏—Ç –≤—Å–µ –ø—É—Ç–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–µ—Ä—ã –∏ Telegram API
- –°–µ–∫—Ä–µ—Ç—ã (TELEGRAM_BOT_TOKEN, CHAT_ID) ‚Äî —á–µ—Ä–µ–∑ .env, –∏—Å–∫–ª—é—á—ë–Ω –∏–∑ Git

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ë—ã—Å—Ç—Ä–æ
```bash
./setup.sh
```

### –í—Ä—É—á–Ω—É—é  
```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -e .
```

## ‚öôÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
watcher-devices     # –°–ø–∏—Å–æ–∫ –∫–∞–º–µ—Ä
watcher-capture     # –ó–∞—Ö–≤–∞—Ç –≤–∏–¥–µ–æ
watcher-tray        # –°–∏—Å—Ç–µ–º–Ω—ã–π —Ç—Ä–µ–π
watcher-status      # –°—Ç–∞—Ç—É—Å
watcher-camera-test # –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
```

### –°–∏—Å—Ç–µ–º–Ω—ã–π —Ç—Ä–µ–π

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `watcher-tray`, –Ω–∞–π–¥–∏—Ç–µ –∑–µ–ª—ë–Ω—ã–π –∑–Ω–∞—á–æ–∫ üü¢ –≤ —Å—Ç—Ä–æ–∫–µ –º–µ–Ω—é macOS (—Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É).

**–ï—Å–ª–∏ –∑–Ω–∞—á–æ–∫ —Ç—Ä–µ—è –Ω–µ –≤–∏–¥–µ–Ω:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Üí –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø
2. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¢–µ—Ä–º–∏–Ω–∞–ª—É –∏–ª–∏ –≤–∞—à–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å: `watcher-tray` —Å–Ω–æ–≤–∞

–ú–µ–Ω—é —Ç—Ä–µ—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
- üìä –°—Ç–∞—Ç—É—Å - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–æ–≤
- üìÇ –û—Ç–∫—Ä—ã—Ç—å –ª–æ–≥–∏ - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ª–æ–≥–æ–≤  
- ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å - –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
- ‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ–Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞
```bash
./install_launchd.sh    # –í–∫–ª—é—á–∏—Ç—å
./uninstall_launchd.sh  # –í—ã–∫–ª—é—á–∏—Ç—å
```

## üóÇ –ù–∞—Å—Ç—Ä–æ–π–∫–∏

`.env` —Ñ–∞–π–ª:
```
TELEGRAM_BOT_TOKEN=...
TELEGRAM_CHAT_ID=...
CAMERA_DEVICE=0
```

## üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
watcher-devices         # –°–ø–∏—Å–æ–∫ –∫–∞–º–µ—Ä
watcher-status          # –°—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–æ–≤
python system_test.py   # –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã
```

## üóë –£–¥–∞–ª–µ–Ω–∏–µ

```bash
./uninstall_launchd.sh  # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≥–µ–Ω—Ç–æ–≤
rm -rf .venv            # –£–¥–∞–ª–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ  
```
